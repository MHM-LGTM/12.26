# 动画系统实施方案（分阶段验收版）

## 📌 方案说明

本方案将动画系统拆解为 **8个可独立验收的小阶段**，每个阶段完成后都有**明确的前端可视化效果**，让你能够：
- ✅ 直观看到进展
- ✅ 及时调整方向
- ✅ 快速发现问题
- ✅ 增强信心

每个阶段都遵循：**后端接口 → 前端展示 → 功能验收** 的闭环。

---

## 🎯 阶段零：数据库准备（5分钟）

### 要做什么
创建数据库表，为后续功能打基础。

### 具体任务
1. 创建 `animations` 表（动画主表）
2. 创建 `animation_likes` 表（点赞表）
3. 运行数据库初始化脚本

### 验收标准
运行数据库查询，能看到两张新表：
```bash
# 在数据库中执行
SHOW TABLES;
# 应该能看到 animations 和 animation_likes
```

### 预计耗时
**15-30分钟**

---

## 🎯 阶段一：显示"下载"按钮 + 假数据测试（可视化验收）

### 要做什么
在画布下方添加"下载"按钮，用假数据测试保存流程。

### 具体任务

#### 后端（10分钟）
1. 创建 `/api/animations` POST 接口（保存动画）
   - 接收参数：title, description, scene_data
   - 返回：动画ID

#### 前端（30分钟）
1. 在画布下方添加"下载"按钮（`开始模拟`旁边）
2. 首次运行模拟后，显示"下载"按钮
3. 点击"下载"弹出保存弹窗：
   - 显示封面预览（用户上传的图片）
   - 输入框：动画名称
   - 输入框：描述（可选）
   - 保存按钮

4. 实现 `captureSceneData()` 函数（从 simulationCache 提取数据）
5. 点击保存→调用后端接口→显示成功提示

### 👀 验收效果

**你能看到：**
1. ✅ 运行模拟后，画布下方出现"⬇️ 下载"按钮
2. ✅ 点击按钮弹出保存弹窗，自动显示封面图
3. ✅ 填写名称后点击保存，提示"保存成功"
4. ✅ 后端数据库中能查到新增的记录

```bash
# 验收命令
SELECT id, title, user_id, created_at FROM animations;
```

### 预计耗时
**1-1.5小时**

---

## 🎯 阶段二：显示"我的动画"面板 + 点击加载（重要里程碑）

### 要做什么
在画布右侧显示"我的动画"面板，显示用户保存的动画列表，点击可以加载到画布。

### 具体任务

#### 后端（15分钟）
1. GET `/api/animations/mine` 获取我的动画列表
   - 返回：id, title, thumbnail_url, created_at
2. GET `/api/animations/{id}` 获取动画详情
   - 返回：完整的 scene_data

#### 前端（1小时）
1. 在画布右侧创建"我的动画"面板
   - 网格布局（2列或3列）
   - 每个卡片显示：封面图 + 动画名称
   
2. 页面加载时，自动请求"我的动画"列表

3. 实现 `loadAnimation()` 函数：
   - 点击卡片→获取动画详情→恢复到画布
   - 填充 simulationCache
   - 显示"下载"按钮

4. 点击"开始模拟"直接运行（无需重新上传图片）

### 👀 验收效果

**你能看到：**
1. ✅ 画布右侧出现"我的动画"面板
2. ✅ 面板中显示你保存的动画卡片（封面图+名称）
3. ✅ 点击某个卡片→画布加载该动画的背景图
4. ✅ 点击"开始模拟"→动画正常运行（物体、运动都正确）
5. ✅ **核心验证：无需重新上传图片、框选元素，一键运行！**

### 📸 验收截图重点
拍照记录：
- 我的动画面板显示效果
- 点击卡片后画布的变化
- 运行模拟的效果

### 预计耗时
**1.5-2小时**

---

## 🎯 阶段三：卡片操作菜单（删除功能）

### 要做什么
在"我的动画"卡片上添加操作菜单，实现删除功能。

### 具体任务

#### 后端（10分钟）
1. DELETE `/api/animations/{id}` 删除动画

#### 前端（30分钟）
1. 卡片悬浮时显示操作按钮（右上角）
2. 点击显示菜单：
   - 🗑️ 删除
   - （其他功能暂时留空）
3. 点击删除→二次确认→调用接口→刷新列表

### 👀 验收效果

**你能看到：**
1. ✅ 鼠标悬浮卡片→右上角出现"..."按钮
2. ✅ 点击按钮→弹出菜单
3. ✅ 点击删除→确认弹窗→删除成功→卡片消失

### 预计耗时
**30-45分钟**

---

## 🎯 阶段四：动画广场面板 + 假数据展示

### 要做什么
在页面底部显示"动画广场"面板，用假数据测试展示效果。

### 具体任务

#### 后端（20分钟）
1. POST `/api/animations/{id}/publish` 发布到广场
   - 参数：is_public=true, show_author（是否显示作者）
2. GET `/api/plaza/animations` 获取广场列表
   - 按 like_count 降序排序
   - 返回：id, title, thumbnail_url, like_count, author_name（可选）

#### 前端（1小时）
1. 在页面底部创建"动画广场"面板
   - 横向滚动布局
   - 每个卡片显示：封面图 + 名称 + ❤️点赞数

2. 页面加载时，自动请求广场列表

3. 先用假数据测试布局效果

4. 在"我的动画"卡片菜单中添加"上传到广场"按钮

### 👀 验收效果

**你能看到：**
1. ✅ 页面底部出现"动画广场"面板
2. ✅ 横向滚动显示多个动画卡片
3. ✅ 每个卡片显示封面、名称、❤️数字
4. ✅ 在"我的动画"中选择一个动画→上传到广场→刷新后在广场中能看到

### 📸 验收截图重点
拍照记录：
- 动画广场的整体布局
- 卡片的显示效果
- 上传到广场的操作流程

### 预计耗时
**1.5小时**

---

## 🎯 阶段五：广场动画点击加载 + 选中状态

### 要做什么
点击广场卡片，动画加载到画布，卡片高亮显示，画布下方显示动画信息。

### 具体任务

#### 前端（1小时）
1. 点击广场卡片→调用 `loadAnimation()`→加载到画布
2. 实现卡片选中状态：
   - CSS：scale(1.05) + 蓝色高亮边框
   - 保存 selectedPlazaCard state

3. 画布下方显示动画信息区（仅在加载广场动画时显示）：
   ```
   ┌─────────────────────────────────────────┐
   │ 📝 弹性碰撞演示        ❤️ 128  👤 物理君 │
   │ 演示两个滑块的碰撞...                    │
   └─────────────────────────────────────────┘
   ```

4. 点击其他卡片→切换选中状态

### 👀 验收效果

**你能看到：**
1. ✅ 点击广场卡片→卡片放大并显示蓝色边框
2. ✅ 画布加载该动画的背景图
3. ✅ 画布下方出现动画信息区，显示名称、描述、点赞数、作者
4. ✅ 点击"开始模拟"→动画正常运行
5. ✅ 点击另一个卡片→上一个卡片取消选中，新卡片高亮

### 📸 验收截图重点
拍照记录：
- 卡片选中前后的对比
- 画布下方信息区的显示效果
- 多个卡片切换的效果

### 预计耗时
**1-1.5小时**

---

## 🎯 阶段六：点赞功能（双入口）

### 要做什么
实现点赞功能，在广场卡片和画布信息区都可以点赞。

### 具体任务

#### 后端（30分钟）
1. POST `/api/plaza/animations/{id}/like` 点赞
   - 检查是否已点赞
   - 写入 animation_likes 表
   - 更新 animations.like_count

2. DELETE `/api/plaza/animations/{id}/like` 取消点赞

3. GET `/api/plaza/animations/{id}/like-status` 查询当前用户是否已点赞

#### 前端（45分钟）
1. 广场卡片上的❤️可点击：
   - 未点赞：灰色❤️
   - 已点赞：红色❤️
   - 点击切换状态

2. 画布下方信息区的❤️可点击（同样逻辑）

3. 未登录时点击→提示登录

4. 点赞后实时更新数字

### 👀 验收效果

**你能看到：**
1. ✅ 点击卡片上的❤️→变红色，数字+1
2. ✅ 再次点击→变灰色，数字-1
3. ✅ 点击画布信息区的❤️→同样效果
4. ✅ 刷新页面→点赞状态保持（已点赞的仍然是红色）
5. ✅ 未登录时点击→弹出登录提示

### 📸 验收截图重点
拍照记录：
- 点赞前后的颜色变化
- 数字的实时更新
- 未登录的提示效果

### 预计耗时
**1-1.5小时**

---

## 🎯 阶段七：广场动画的"下载"按钮（Fork功能）

### 要做什么
复用"下载"按钮，加载广场动画时，点击"下载"将其复制到"我的动画"。

### 具体任务

#### 后端（20分钟）
1. POST `/api/plaza/animations/{id}/fork` Fork动画
   - 复制 scene_data 到新记录
   - user_id = 当前用户
   - is_public = false
   - fork_from = 原动画ID

#### 前端（30分钟）
1. 修改"下载"按钮逻辑：
   ```javascript
   if (当前是广场动画) {
     // 调用 Fork 接口
     // 提示"已保存到我的动画"
   } else {
     // 原有的保存逻辑
   }
   ```

2. Fork成功后：
   - 刷新"我的动画"列表
   - 提示"已保存到我的动画"

### 👀 验收效果

**你能看到：**
1. ✅ 点击广场动画卡片→加载到画布
2. ✅ 点击"下载"按钮→提示"已保存到我的动画"
3. ✅ "我的动画"面板自动刷新，新增一个动画
4. ✅ 点击新增的动画→正常运行
5. ✅ 修改参数后保存→不影响原广场动画（独立副本）

### 📸 验收截图重点
拍照记录：
- Fork前后"我的动画"列表的变化
- Fork后的动画独立性验证

### 预计耗时
**45分钟-1小时**

---

## 🎯 阶段八：分享链接（完整闭环）

### 要做什么
生成分享链接，朋友可以通过链接直接打开并运行动画。

### 具体任务

#### 后端（30分钟）
1. POST `/api/animations/{id}/share-link` 生成分享链接
   - 生成唯一 share_code（6位随机字符串）
   - 返回完整链接
2. GET `/api/play/{share_code}` 获取动画数据（公开接口）

#### 前端（1小时）
1. "我的动画"卡片菜单中添加"分享"按钮

2. 点击分享→弹窗显示链接：
   ```
   ┌────────────────────────────────┐
   │ 🔗 分享链接                     │
   │                                │
   │ https://physmath.cn/play/abc123│
   │                      📋 复制   │
   │                                │
   │ 分享给朋友，直接运行动画        │
   └────────────────────────────────┘
   ```

3. 创建播放页 `/physics/play/:shareCode`
   - 精简UI，只有画布和动画信息
   - 自动加载并运行动画
   - 显示"下载到我的动画"按钮（需登录）

### 👀 验收效果

**你能看到：**
1. ✅ 点击"我的动画"卡片的分享按钮→弹出链接
2. ✅ 点击复制→提示"已复制"
3. ✅ 在浏览器新标签打开链接→跳转到播放页
4. ✅ 播放页自动显示动画，点击"开始模拟"正常运行
5. ✅ 朋友（未登录）也能访问链接并运行动画
6. ✅ 登录后可以点击"下载"保存到自己的动画库

### 📸 验收截图重点
拍照记录：
- 分享弹窗效果
- 播放页的完整界面
- 未登录访问的效果
- 登录后下载的流程

### 预计耗时
**1.5-2小时**

---

## 📊 总体进度表

| 阶段 | 任务 | 预计耗时 | 累计耗时 | 可视化验收点 |
|------|------|---------|---------|-------------|
| 0 | 数据库准备 | 30分钟 | 0.5h | 查看数据库表 |
| 1 | 下载按钮+保存弹窗 | 1-1.5h | 2h | ✅ 按钮显示、弹窗、保存成功 |
| 2 | 我的动画面板+加载 | 1.5-2h | 4h | ✅ 面板、卡片、点击加载运行 |
| 3 | 卡片菜单+删除 | 30-45分钟 | 4.5h | ✅ 菜单显示、删除交互 |
| 4 | 动画广场面板+上传 | 1.5h | 6h | ✅ 广场布局、上传流程 |
| 5 | 广场加载+选中状态 | 1-1.5h | 7.5h | ✅ 高亮边框、信息区显示 |
| 6 | 点赞功能 | 1-1.5h | 9h | ✅ 双入口点赞、状态保持 |
| 7 | Fork功能 | 45分钟-1h | 10h | ✅ 复制到我的动画 |
| 8 | 分享链接+播放页 | 1.5-2h | 12h | ✅ 链接生成、播放页访问 |

**总计：约 10-12 小时**（分多天完成，每天1-2个阶段）

---

## 🎬 每阶段的验收流程

### 标准验收三步骤

#### 1️⃣ 视觉检查（5分钟）
- 打开页面，观察UI变化
- 拍照记录关键界面
- 对比设计方案的原型图

#### 2️⃣ 功能测试（10分钟）
- 按照"验收效果"逐项测试
- 记录bug或不符合预期的地方
- 测试边界情况（如未登录、空数据）

#### 3️⃣ 数据验证（5分钟）
- 查看数据库记录是否正确
- 检查控制台是否有错误
- 验证网络请求是否成功

### 验收通过标准
- ✅ 所有"👀 验收效果"清单项都能实现
- ✅ 没有明显的视觉bug
- ✅ 没有控制台报错
- ✅ 数据库记录正确

### 验收不通过处理
- ❌ 记录问题清单
- 🔧 立即修复bug
- 🔄 重新验收

---

## 💡 实施建议

### 第一周（核心功能）
- **Day 1**: 阶段0 + 阶段1（下载按钮）
- **Day 2**: 阶段2（我的动画面板）← **重要里程碑**
- **Day 3**: 阶段3（删除功能）

→ 此时你已经可以：保存动画、查看列表、加载运行、删除

### 第二周（社区功能）
- **Day 4**: 阶段4（动画广场面板）
- **Day 5**: 阶段5（广场加载）+ 阶段6（点赞）
- **Day 6**: 阶段7（Fork）+ 阶段8（分享）

→ 此时完整功能已实现

### 时间分配建议
- **工作日**：每天1个阶段（1-1.5小时）
- **周末**：每天2-3个阶段（3-4小时）

### 遇到问题怎么办
1. **UI不符合预期**：先截图，描述期望效果，我帮你调整
2. **功能不work**：提供报错信息或描述现象，我帮你排查
3. **不知道怎么实现**：说明具体卡在哪一步，我提供代码

---

## 🎯 验收记录表（建议使用）

复制下面的表格到单独文件，每完成一个阶段就打勾：

```markdown
## 动画系统实施验收记录

### 阶段1：下载按钮+保存弹窗
- [ ] 运行模拟后按钮显示
- [ ] 弹窗显示封面图
- [ ] 保存成功提示
- [ ] 数据库记录正确
- **完成时间**：____
- **截图路径**：____
- **问题记录**：____

### 阶段2：我的动画面板+加载
- [ ] 面板显示在右侧
- [ ] 卡片正确显示
- [ ] 点击卡片加载成功
- [ ] 运行动画正确
- **完成时间**：____
- **截图路径**：____
- **问题记录**：____

（以此类推...）
```

---

## ✅ 最终验收（全功能）

完成所有8个阶段后，进行最终完整验收：

### 完整用户旅程测试

#### 旅程A：创作者流程
1. 上传图片→分析→框选→运行模拟
2. 点击"下载"保存动画
3. 在"我的动画"看到新卡片
4. 上传到广场
5. 生成分享链接

#### 旅程B：使用者流程
1. 打开网站，浏览动画广场
2. 点击一个动画卡片→加载到画布
3. 点击"开始模拟"运行
4. 点赞
5. 点击"下载"保存到我的动画

#### 旅程C：访客流程
1. 打开朋友分享的链接
2. 自动运行动画
3. 注册登录后保存到自己的库

### 性能检查
- [ ] 首次加载页面 < 3秒
- [ ] 点击卡片加载动画 < 1秒
- [ ] 保存/Fork操作 < 2秒

### 兼容性检查
- [ ] Chrome浏览器正常
- [ ] 移动端浏览器基本可用（可后续优化）

---

## 🎉 完成标志

当你能够：
1. ✅ 保存一个动画到"我的动画"
2. ✅ 点击卡片加载并运行
3. ✅ 上传到广场让别人看到
4. ✅ 从广场下载别人的动画
5. ✅ 点赞功能正常工作
6. ✅ 分享链接可以访问

→ **恭喜，动画系统完整上线！**🎊

---

## 📝 附录：快速命令参考

```bash
# 查看动画列表
SELECT id, title, user_id, is_public, like_count FROM animations;

# 查看点赞记录
SELECT * FROM animation_likes;

# 统计我的动画数量
SELECT COUNT(*) FROM animations WHERE user_id = 你的用户ID;

# 统计广场动画数量
SELECT COUNT(*) FROM animations WHERE is_public = 1;

# 查看最受欢迎的动画
SELECT id, title, like_count FROM animations WHERE is_public = 1 ORDER BY like_count DESC LIMIT 5;
```

---

**现在，你可以随时喊停、调整方向、要求修改。每个阶段都在你的掌控之中！** 🚀

