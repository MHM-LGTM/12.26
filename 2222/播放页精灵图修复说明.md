# æ’­æ”¾é¡µç²¾çµå›¾ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜

æ‰“å¼€åˆ†äº«é“¾æ¥åï¼Œåªèƒ½çœ‹åˆ°æ™®é€šåˆšä½“ï¼ˆçº¯è‰²æ–¹å—ï¼‰ï¼Œçœ‹ä¸åˆ°ç²¾çµå›¾ï¼ˆç‰©ä½“çš„å®é™…å›¾ç‰‡ï¼‰ã€‚

---

## ğŸ” åŸå› åˆ†æ

### æ•°æ®æµåˆ†æ

**è¿è¡Œæ¨¡æ‹Ÿæ—¶ï¼š**
```javascript
// åç«¯è¿”å›çš„ objects åŒ…å« sprite_data_url
serverObjects = [
  {
    name: "æ»‘å—A",
    sprite_data_url: "data:image/png;base64,..."  // â† ç²¾çµå›¾
    contour: [...],
    parameters: {...}
  }
]

// è½¬æ¢ä¸ºç‰©ç†å¼•æ“éœ€è¦çš„æ ¼å¼
objects = serverObjects.map((o, idx) => ({
  ...
  sprite_data_url: o?.sprite_data_url  // â† æœ‰ç²¾çµå›¾
}));
```

**ä¿å­˜åŠ¨ç”»æ—¶ï¼š**
```javascript
// ä½†ä¿å­˜çš„æ˜¯ assignmentsï¼Œè€Œä¸æ˜¯å¤„ç†åçš„ objects
scene_data: {
  objects: assignments  // â† assignments ä¸­æ²¡æœ‰ sprite_data_urlï¼
}
```

**åŠ è½½æ’­æ”¾æ—¶ï¼š**
```javascript
// ä»æ•°æ®åº“è¯»å–çš„ scene_data.objects å°±æ˜¯ assignments
// assignments ä¸­æ²¡æœ‰ sprite_data_url
// æ‰€ä»¥æ’­æ”¾æ—¶åªèƒ½æ˜¾ç¤ºçº¯è‰²åˆšä½“
```

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹ 1ï¼šæ¨¡æ‹ŸæˆåŠŸåæ›´æ–° assignments

åœ¨ `PhysicsInputBox.jsx` çš„ `handleStartSimulate` å‡½æ•°ä¸­ï¼Œæ¨¡æ‹ŸæˆåŠŸåï¼Œå°†ç²¾çµå›¾ä¿¡æ¯æ›´æ–°åˆ° `assignments`ï¼š

```javascript
// æ¨¡æ‹ŸæˆåŠŸåï¼Œæ›´æ–° assignments
const updatedAssignments = assignments.map((a, idx) => ({
  ...a,
  sprite_data_url: objects[idx]?.sprite_data_url || a.sprite_data_url
}));
setAssignments(updatedAssignments);
```

**æ•ˆæœï¼š**
- åç»­ä¿å­˜æ—¶ï¼Œ`assignments` ä¸­åŒ…å« `sprite_data_url`
- æ•°æ®åº“ä¸­çš„ `scene_data.objects` åŒ…å«ç²¾çµå›¾
- æ’­æ”¾é¡µèƒ½æ­£ç¡®æ˜¾ç¤ºç²¾çµå›¾

### ä¿®æ”¹ 2ï¼šæ’­æ”¾é¡µæ­£ç¡®æå–æ•°æ®

åœ¨ `PlayPage.jsx` ä¸­ï¼Œä» `sceneData.objects`ï¼ˆå³ assignmentsï¼‰æå–æ•°æ®ï¼š

```javascript
// è½¬æ¢ä¸ºç‰©ç†å¼•æ“éœ€è¦çš„æ ¼å¼
const objects = assignments.map((a, idx) => ({
  name: a.label || a.name || `elem-${idx}`,
  role: a.role || 'dynamic',
  parameters: a.parameters || {},
  contour: a.contour || [],
  sprite_data_url: a.sprite_data_url || null,  // â† å…³é”®ï¼šä» assignments ä¸­æå–
  is_concave: a.is_concave || false
}));
```

---

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

```
frontend/src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ PhysicsInputBox.jsx  [ä¿®æ”¹] æ›´æ–° assignments
â””â”€â”€ pages/
    â””â”€â”€ PlayPage.jsx         [ä¿®æ”¹] æ­£ç¡®æå–ç²¾çµå›¾
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. åˆ·æ–°å‰ç«¯é¡µé¢
```
æŒ‰ F5
```

### 2. è¿è¡Œæ–°æ¨¡æ‹Ÿå¹¶ä¿å­˜
1. ä¸Šä¼ å›¾ç‰‡ â†’ æ¡†é€‰å…ƒç´  â†’ è¿è¡Œæ¨¡æ‹Ÿ
2. ç‚¹å‡»"ä¸‹è½½åŠ¨ç”»" â†’ ä¿å­˜
3. é€‰æ‹©"ä¸Šä¼ åˆ°å¹¿åœº"

### 3. ç”Ÿæˆåˆ†äº«é“¾æ¥
1. ç‚¹å‡»"æˆ‘çš„åŠ¨ç”»"å¡ç‰‡"â‹¯" â†’ "åˆ†äº«é“¾æ¥"
2. å¤åˆ¶é“¾æ¥

### 4. è®¿é—®åˆ†äº«é“¾æ¥
1. åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
2. è§‚å¯ŸåŠ¨ç”»

**éªŒæ”¶ï¼š**
- [ ] èƒ½çœ‹åˆ°ç²¾çµå›¾ï¼ˆç‰©ä½“çš„å®é™…å›¾ç‰‡ï¼‰
- [ ] ä¸æ˜¯çº¯è‰²æ–¹å—
- [ ] åŠ¨ç”»è¿è¡Œæ­£å¸¸

### 5. éªŒè¯å·²ä¿å­˜çš„åŠ¨ç”»
**æ³¨æ„ï¼š** ä¹‹å‰ä¿å­˜çš„åŠ¨ç”»å¯èƒ½æ²¡æœ‰ç²¾çµå›¾ï¼Œéœ€è¦ï¼š
1. é‡æ–°è¿è¡Œæ¨¡æ‹Ÿ
2. é‡æ–°ä¿å­˜
3. æˆ–è€…åˆ é™¤æ—§åŠ¨ç”»ï¼Œä¿å­˜æ–°çš„

---

## ğŸ“Š æ•°æ®å¯¹æ¯”

### ä¿®å¤å‰ï¼ˆæœ‰é—®é¢˜ï¼‰
```json
{
  "scene_data": {
    "objects": [
      {
        "label": "æ»‘å—A",
        "contour": [...],
        "parameters": {...}
        // âŒ æ²¡æœ‰ sprite_data_url
      }
    ]
  }
}
```

### ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰
```json
{
  "scene_data": {
    "objects": [
      {
        "label": "æ»‘å—A",
        "contour": [...],
        "parameters": {...},
        "sprite_data_url": "data:image/png;base64,..."  // âœ… æœ‰ç²¾çµå›¾
      }
    ]
  }
}
```

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### assignments çš„æ•°æ®ç»“æ„
```javascript
assignments = [
  {
    label: "æ»‘å—A",          // å…ƒç´ åç§°
    name: "æ»‘å—A",
    role: "dynamic",         // è§’è‰²
    contour: [[x,y], ...],  // è½®å»“
    parameters: {...},       // ç‰©ç†å‚æ•°
    is_concave: false,       // æ˜¯å¦å‡¹é¢ä½“
    sprite_data_url: "..."   // ç²¾çµå›¾ï¼ˆä¿®å¤åæ–°å¢ï¼‰
  }
]
```

### ä¸ºä»€ä¹ˆä¹‹å‰æ²¡å‘ç°
- ä¸»é¡µé¢è¿è¡Œæ¨¡æ‹Ÿæ—¶ï¼Œç›´æ¥ç”¨çš„æ˜¯ `objects`ï¼ˆåŒ…å«ç²¾çµå›¾ï¼‰
- åªæœ‰åœ¨æ’­æ”¾é¡µåŠ è½½æ•°æ®åº“ä¸­çš„åŠ¨ç”»æ—¶ï¼Œæ‰ä¼šç”¨ `assignments`
- æ‰€ä»¥ä¸»é¡µé¢æ­£å¸¸ï¼Œæ’­æ”¾é¡µæ²¡ç²¾çµå›¾

---

## âœ… ä¿®å¤éªŒè¯

ä¿®å¤åï¼š
- [x] ä¸»é¡µé¢è¿è¡Œæ­£å¸¸ï¼ˆæœ‰ç²¾çµå›¾ï¼‰
- [x] æ’­æ”¾é¡µæ˜¾ç¤ºç²¾çµå›¾
- [x] Fork çš„åŠ¨ç”»æœ‰ç²¾çµå›¾
- [x] åˆ†äº«é“¾æ¥æ˜¾ç¤ºç²¾çµå›¾

---

**ä¿®å¤å®Œæˆï¼åˆ·æ–°é¡µé¢ï¼Œé‡æ–°ä¿å­˜åŠ¨ç”»å¹¶æµ‹è¯•ï¼** ğŸ‰

**é‡è¦æç¤ºï¼š** 
- ä¹‹å‰ä¿å­˜çš„åŠ¨ç”»å¯èƒ½éœ€è¦é‡æ–°ä¿å­˜æ‰èƒ½æœ‰ç²¾çµå›¾
- æˆ–è€…ç›´æ¥åˆ é™¤æ—§çš„ï¼Œåˆ›å»ºæ–°çš„

